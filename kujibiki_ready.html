<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>くじ引き</title>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP" rel="stylesheet" />
    <link rel="stylesheet" href="./css/kujibiki.css">
</head>
<body>
    <main class="transparent-bg">
        <div class="ready">
            
            <h2>準備</h2>

            <div class="step1">
                <p class="title">Step1. テーマを入力</p>
                <p class="ex">入力例）掃除当番、飲み会幹事</p>
                <div class="settei">
                    <input type="text" id="theme" val=""/>
                    <p class="sub_text">を決める
                    </p>
                </div>
            </div>

            <div class="step2">
                <p class="title">Step2. 参加人数を選択</p>
                <div class="enter_participant">
                    <select id="participant">
                        <option value="" disabled selected>--選択してください--</option>
                        <option value="2">2人</option>
                        <option value="3">3人</option>
                        <option value="4">4人</option>
                        <option value="5">5人</option>
                    </select>
                </div>
            </div>

            <div class="step3">
                <p class="title">Step3. 当たる人数を選択</p>
                <div class="enter_winner">
                    <select id="winner">
                        <option value="" disabled selected>--選択してください--</option>
                    </select>
                </div>
            </div>
            
            <div class="step4">
                <button id="next_kujibiki">くじを引く >></button>
            </div>
        </div>
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script>
        // 定義
        let theme=""
        let participant = 0;
        let maxParticipant = 0;
        let maxAtari =0;
        const name_ary=[];  //配列を定義
        
        // 入力欄に何か入力されたら発動
        $("#theme").on('change',function(){ 
            theme = $( this ).val();
        });

        // 参加人数の値を取得
        $("#participant").on('change',function(){ 
            participant = $( this ).val();
            maxParticipant = parseInt(participant);

            // 当たる人数の選択肢をリセット
            $("#winner").empty();
            $("#winner").append('<option value="" disabled selected>--選択してください--</option>');

            // 当たる人数の上限値分の選択肢をhtml内に設定
            for(let i=1; i<maxParticipant; i++){
                $("#winner").append('<option value="'+i+'">'+i+'人</option>');
            }

            // 選ぶ枠をリセット
            $(".entername").empty();

            // 当たる人数分の選ぶ枠をhtml内に設定、画像をランダムに表示
            for(let i=1; i<=maxParticipant; i++){
                const random_img = Math.floor(Math.random()*5) + 1;
                $(".entername").append('<div class="row_choices"> <img src="./images/kuji'+random_img+'.png" id="kuji" class="kuji'+i+'" alt="くじ"> <input type="text" class="name_ary" placeholder="名前を入力してください" name="name" value=""> </div>');
            }
        });

        // 当選人数の値を取得
        $("#winner").on('change',function(){ 
            atari_num = $( this ).val();
            maxAtari = parseInt(atari_num);
            console.log("当たり人数"+maxAtari);
        });

        function goToKujibikiPage() {
            // 1. データをURLエンコードする
            const encodedTheme = encodeURIComponent(theme);
            const encodedParticipant = encodeURIComponent(participant);
            const encodedWinner = encodeURIComponent(maxAtari);

            // 2. クエリパラメータを作成
            const query = 
                `?theme=${encodedTheme}&participants=${encodedParticipant}&winners=${encodedWinner}`;

            // 3. 次のページにデータを付加して遷移
            window.location.href = "kujibiki_result.html" + query;
        }

        // ボタンにイベントリスナーを登録 (ボタンのIDを #next_kujibiki と仮定)
        $("#next_kujibiki").on("click", goToKujibikiPage);
    </script>
</body>
</html>